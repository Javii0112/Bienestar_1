{% extends 'base.html' %}

{% block title %}Mis Estad√≠sticas | Bienestar Campus{% endblock %}

{% block page_name %}Mis Estad√≠sticas{% endblock %}

{% block extra_css %}
<style>
.stats-header {
    text-align: center;
    margin-bottom: 40px;
}

.stats-header h1 {
    color: #006d63;
    font-size: 32px;
    margin: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.stats-header p {
    color: #666;
    margin-top: 10px;
}

.week-chart {
    background: #e8f8f5;
    padding: 30px;
    border-radius: 15px;
    margin-bottom: 40px;
}

.week-chart h3 {
    margin-top: 0;
    color: #006d63;
    margin-bottom: 20px;
}

.chart-container {
    display: flex;
    justify-content: space-around;
    align-items: flex-end;
    height: 200px;
    margin-top: 20px;
}

.day-column {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    position: relative;
}

.bar-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-end;
    height: 200px;
}

.bar {
    width: 60%;
    background: linear-gradient(180deg, #00c6a7, #00796b);
    border-radius: 10px 10px 0 0;
    transition: all 0.3s ease;
    min-height: 0;
    position: relative;
}

.bar.vacio {
    background: #d0e8e5;
    min-height: 8px;
}

.bar:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(0, 121, 107, 0.3);
}

/* Tooltip al hacer hover */
.bar[data-promedio]:hover::after {
    content: attr(data-promedio);
    position: absolute;
    top: -30px;
    left: 50%;
    transform: translateX(-50%);
    background: #006d63;
    color: white;
    padding: 3px 8px;
    border-radius: 6px;
    font-size: 12px;
    white-space: nowrap;
}

.day-label {
    font-weight: 600;
    color: #555;
    font-size: 14px;
}

.no-data-msg {
    text-align: center;
    color: #aaa;
    font-size: 14px;
    margin-top: 10px;
}

.legend {
    display: flex;
    justify-content: center;
    gap: 30px;
    margin-top: 20px;
    font-size: 14px;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
}

.legend-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
}

.stats-cards {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 25px;
}

.stat-card {
    background: white;
    padding: 30px;
    border-radius: 15px;
    text-align: center;
    box-shadow: 0 10px 25px rgba(0,0,0,0.08);
    transition: transform 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-5px);
}

.stat-card.blue {
    background: linear-gradient(135deg, #e3f2fd, #bbdefb);
}

.stat-card.orange {
    background: linear-gradient(135deg, #fff3e0, #ffe0b2);
}

.stat-card.pink {
    background: linear-gradient(135deg, #fce4ec, #f8bbd0);
}

.stat-icon {
    font-size: 48px;
    margin-bottom: 15px;
}

.stat-number {
    font-size: 36px;
    font-weight: bold;
    color: #006d63;
    margin: 10px 0;
}

.stat-label {
    color: #555;
    font-weight: 600;
}

@media (max-width: 768px) {
    .stats-cards {
        grid-template-columns: 1fr;
    }

    .chart-container {
        height: 150px;
    }
}
</style>
{% endblock %}

{% block content %}

<div class="stats-header">
    <h1>üìä Mis Estad√≠sticas</h1>
    <p>Visualiza tu progreso y tendencias</p>
</div>

<!-- Gr√°fico de la semana -->
<div class="week-chart">
    <h3>Estado de √Ånimo - √öltima Semana</h3>

    <div class="chart-container">
    {% for dia in grafico_semana %}
    <div class="day-column">
        <div class="bar-wrapper">
            {% if dia.altura == 0 %}
                <div class="bar vacio" style="height: 8px;"></div>
            {% else %}
                <div class="bar" style="height: {{ dia.altura }}px;" data-promedio="{{ dia.promedio }}/5"></div>
            {% endif %}
        </div>
        <span class="day-label">{{ dia.label }}</span>
    </div>
    {% endfor %}
    </div>
    {% if total_registros == 0 %}
        <p class="no-data-msg">A√∫n no tienes emociones registradas esta semana. ¬°Empieza desde el dashboard! üíö</p>
    {% endif %}

    <div class="legend">
        <div class="legend-item">
            <span class="legend-dot" style="background: #d32f2f;"></span>
            <span>1 = Muy mal</span>
        </div>
        <div class="legend-item">
            <span class="legend-dot" style="background: #4caf50;"></span>
            <span>5 = Muy bien</span>
        </div>
        <div class="legend-item">
            <span class="legend-dot" style="background: #d0e8e5;"></span>
            <span>Sin registro</span>
        </div>
    </div>
</div>

<!-- Tarjetas de estad√≠sticas -->
<div class="stats-cards">
    <div class="stat-card blue">
        <div class="stat-icon">üß†</div>
        <div class="stat-number">{{ total_registros }}</div>
        <div class="stat-label">Emociones registradas</div>
    </div>

    <div class="stat-card orange">
        <div class="stat-icon">üìä</div>
        <div class="stat-number">{{ intensidad_promedio }}</div>
        <div class="stat-label">Intensidad promedio</div>
    </div>

    <div class="stat-card pink">
        <div class="stat-icon">üòä</div>
        <div class="stat-number" style="font-size: 22px; padding-top: 8px;">{{ emocion_frecuente }}</div>
        <div class="stat-label">Emoci√≥n m√°s frecuente</div>
    </div>
</div>

<!-- Resumen adicional -->
<div class="card" style="margin-top: 40px;">
    <h3>üìà Resumen General</h3>

    <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
        <div style="background: #f5f5f5; padding: 20px; border-radius: 10px;">
            <h4 style="margin: 0 0 10px 0; color: #006d63;">üí™ Esta Semana</h4>
            <p style="margin: 5px 0;">Ejercicio: <strong>5 d√≠as</strong></p>
            <p style="margin: 5px 0;">Agua: <strong>48 vasos</strong></p>
            <p style="margin: 5px 0;">Sue√±o promedio: <strong>7.2 hrs</strong></p>
        </div>

        <div style="background: #f5f5f5; padding: 20px; border-radius: 10px;">
            <h4 style="margin: 0 0 10px 0; color: #006d63;">üòä Estado Emocional</h4>
            <p style="margin: 5px 0;">Emoci√≥n m√°s frecuente: <strong>{{ emocion_frecuente }}</strong></p>
            <p style="margin: 5px 0;">Intensidad promedio: <strong>{{ intensidad_promedio }}/5</strong></p>
            <p style="margin: 5px 0;">Registros totales: <strong>{{ total_registros }}</strong></p>
        </div>
    </div>
</div>

<a href="{% url 'dashboard' %}">
    <button style="margin-top: 30px;">‚¨Ö Volver al inicio</button>
</a>

{% endblock %}